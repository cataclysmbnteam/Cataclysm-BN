name: "Pull translations from Transifex"

on:
  workflow_dispatch:
  schedule:
    - cron: "42 1 * * 6"

jobs:
  pull-translations:
    if: github.repository == 'cataclysmbnteam/Cataclysm-BN'
    runs-on: ubuntu-20.04

    steps:
      - name: "Install Transifex CLI"
        run: |
          curl -sL https://github.com/transifex/cli/releases/download/v1.6.7/tx-linux-amd64.tar.gz | sudo tar zxvf - -C /usr/bin tx

      - name: "Checkout"
        uses: actions/checkout@v4
        with:
          filter: blob:none
          sparse-checkout: |
            .tx
            lang

      - name: "Get current date"
        uses: nanzm/get-time-action@v1.1
        id: get-timestamp
        with:
          timeZone: 0
          format: "YYYY-MM-DD"

      - name: "Pull translations"
        run: tx pull --force
        env:
          TX_TOKEN: ${{ secrets.TX_TOKEN }}

      - name: Create Pull Request
        uses: peter-evans/create-pull-request@v3.10.0
        with:
          commit-message: "feat(i18n): routine i18n updates on ${{ steps.get-timestamp.outputs.time }}"
          committer: "github-actions[bot] <github-actions[bot]@users.noreply.github.com>"
          author: "github-actions[bot] <github-actions[bot]@users.noreply.github.com>"
          token: ${{ secrets.TX_PR_CREATOR }}
          branch: i18n
          delete-branch: true
          base: main
          title: "feat(i18n): routine i18n updates on ${{ steps.get-timestamp.outputs.time }}"
          body: ""
          labels: Translation
